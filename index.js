(()=>{"use strict";const t={rus:{KeyQ:{shiftUp:"й",shiftDown:"Й",capsLock:"Й"},KeyW:{shiftUp:"ц",shiftDown:"Ц",capsLock:"Ц"},Backspace:{shiftUp:"Backspace",shiftDown:"Backspace",capsLock:"Backspace"},KeyE:{shiftUp:"у",shiftDown:"У",capsLock:"У"},KeyR:{shiftUp:"к",shiftDown:"К",capsLock:"К"},KeyT:{shiftUp:"е",shiftDown:"Е",capsLock:"Е"},KeyY:{shiftUp:"н",shiftDown:"Н",capsLock:"Н"},KeyU:{shiftUp:"г",shiftDown:"Г",capsLock:"Г"},KeyI:{shiftUp:"ш",shiftDown:"Ш",capsLock:"Ш"},KeyO:{shiftUp:"щ",shiftDown:"Щ",capsLock:"Щ"},KeyP:{shiftUp:"з",shiftDown:"З",capsLock:"З"},BracketLeft:{shiftUp:"х",shiftDown:"Х",capsLock:"Х"},BracketRight:{shiftUp:"ъ",shiftDown:"Ъ",capsLock:"Ъ"},Backslash:{shiftUp:"\\",shiftDown:"/",capsLock:"\\"},KeyA:{shiftUp:"ф",shiftDown:"Ф",capsLock:"Ф"},KeyS:{shiftUp:"ы",shiftDown:"Ы",capsLock:"Ы"},KeyD:{shiftUp:"в",shiftDown:"В",capsLock:"В"},KeyF:{shiftUp:"а",shiftDown:"А",capsLock:"А"},KeyG:{shiftUp:"п",shiftDown:"П",capsLock:"П"},KeyH:{shiftUp:"р",shiftDown:"Р",capsLock:"Р"},KeyJ:{shiftUp:"о",shiftDown:"О",capsLock:"О"},KeyK:{shiftUp:"л",shiftDown:"Л",capsLock:"Л"},KeyL:{shiftUp:"д",shiftDown:"Д",capsLock:"Д"},Semicolon:{shiftUp:"ж",shiftDown:"Ж",capsLock:"Ж"},Quote:{shiftUp:"э",shiftDown:"Э",capsLock:"Э"},Enter:{shiftUp:"Enter",shiftDown:"Enter",capsLock:"Enter"},ShiftRight:{shiftUp:"",shiftDown:"Shift",capsLock:""},Slash:{shiftUp:".",shiftDown:",",capsLock:"."},Period:{shiftUp:"ю",shiftDown:"Ю",capsLock:"Ю"},Comma:{shiftUp:"б",shiftDown:"Б",capsLock:"Б"},KeyM:{shiftUp:"ь",shiftDown:"Ь",capsLock:"Ь"},KeyN:{shiftUp:"т",shiftDown:"Т",capsLock:"Т"},KeyB:{shiftUp:"и",shiftDown:"И",capsLock:"И"},KeyV:{shiftUp:"м",shiftDown:"М",capsLock:"М"},KeyC:{shiftUp:"с",shiftDown:"С",capsLock:"С"},KeyX:{shiftUp:"ч",shiftDown:"Ч",capsLock:"Ч"},KeyZ:{shiftUp:"я",shiftDown:"Я",capsLock:"Я"},ShiftLeft:{shiftUp:"",shiftDown:"Shift",capsLock:""},ControlLeft:{shiftUp:"Control",shiftDown:"Control",capsLock:"Control"},MetaLeft:{shiftUp:"Meta",shiftDown:"Meta",capsLock:"Meta"},AltLeft:{shiftUp:"Alt",shiftDown:"Alt",capsLock:"Alt"},Space:{shiftUp:" ",shiftDown:" ",capsLock:" "},AltRight:{shiftUp:"AltGraph",shiftDown:"AltGraph",capsLock:"AltGraph"},ControlRight:{shiftUp:"Control",shiftDown:"Control",capsLock:"Control"},ArrowLeft:{shiftUp:"ArrowLeft",shiftDown:"ArrowLeft",capsLock:"ArrowLeft"},ArrowDown:{shiftUp:"ArrowDown",shiftDown:"ArrowDown",capsLock:"ArrowDown"},ArrowRight:{shiftUp:"ArrowRight",shiftDown:"ArrowRight",capsLock:"ArrowRight"},ArrowUp:{shiftUp:"ArrowUp",shiftDown:"ArrowUp",capsLock:"ArrowUp"},Equal:{shiftUp:"=",shiftDown:"+",capsLock:"="},Minus:{shiftUp:"-",shiftDown:"_",capsLock:"-"},Digit0:{shiftUp:"0",shiftDown:")",capsLock:"0"},Digit9:{shiftUp:"9",shiftDown:"(",capsLock:"9"},Digit8:{shiftUp:"8",shiftDown:"*",capsLock:"8"},Digit7:{shiftUp:"7",shiftDown:"?",capsLock:"7"},Digit6:{shiftUp:"6",shiftDown:":",capsLock:"6"},Digit5:{shiftUp:"5",shiftDown:"%",capsLock:"5"},Digit4:{shiftUp:"4",shiftDown:";",capsLock:"4"},Digit3:{shiftUp:"3",shiftDown:"№",capsLock:"3"},Digit2:{shiftUp:"2",shiftDown:'"',capsLock:"2"},Digit1:{shiftUp:"1",shiftDown:"!",capsLock:"1"},Backquote:{shiftUp:"ё",shiftDown:"Ё",capsLock:"Ё"},Tab:{shiftUp:"Tab",shiftDown:"Tab",capsLock:"Tab"},CapsLock:{shiftUp:"CapsLock",shiftDown:"CapsLock",capsLock:"CapsLock"},Delete:{shiftUp:"Delete",shiftDown:"Delete",capsLock:"Delete"}},eng:{KeyQ:{shiftUp:"q",shiftDown:"Q",capsLock:"Q"},KeyW:{shiftUp:"w",shiftDown:"W",capsLock:"W"},KeyE:{shiftUp:"e",shiftDown:"E",capsLock:"E"},KeyR:{shiftUp:"r",shiftDown:"R",capsLock:"R"},KeyT:{shiftUp:"t",shiftDown:"T",capsLock:"T"},KeyY:{shiftUp:"y",shiftDown:"Y",capsLock:"Y"},KeyU:{shiftUp:"u",shiftDown:"U",capsLock:"U"},KeyI:{shiftUp:"i",shiftDown:"I",capsLock:"I"},KeyO:{shiftUp:"o",shiftDown:"O",capsLock:"O"},KeyP:{shiftUp:"p",shiftDown:"P",capsLock:"P"},BracketLeft:{shiftUp:"[",shiftDown:"{",capsLock:"["},BracketRight:{shiftUp:"]",shiftDown:"}",capsLock:"]"},Quote:{shiftUp:"'",shiftDown:'"',capsLock:"'"},Semicolon:{shiftUp:";",shiftDown:":",capsLock:";"},KeyL:{shiftUp:"l",shiftDown:"L",capsLock:"L"},KeyK:{shiftUp:"k",shiftDown:"K",capsLock:"K"},KeyJ:{shiftUp:"j",shiftDown:"J",capsLock:"J"},KeyH:{shiftUp:"h",shiftDown:"H",capsLock:"H"},KeyG:{shiftUp:"g",shiftDown:"G",capsLock:"G"},KeyF:{shiftUp:"f",shiftDown:"F",capsLock:"F"},KeyD:{shiftUp:"d",shiftDown:"D",capsLock:"D"},KeyS:{shiftUp:"s",shiftDown:"S",capsLock:"S"},KeyA:{shiftUp:"a",shiftDown:"A",capsLock:"A"},KeyZ:{shiftUp:"z",shiftDown:"Z",capsLock:"Z"},KeyX:{shiftUp:"x",shiftDown:"X",capsLock:"X"},KeyC:{shiftUp:"c",shiftDown:"C",capsLock:"C"},KeyV:{shiftUp:"v",shiftDown:"V",capsLock:"V"},KeyB:{shiftUp:"b",shiftDown:"B",capsLock:"B"},KeyN:{shiftUp:"n",shiftDown:"N",capsLock:"N"},KeyM:{shiftUp:"m",shiftDown:"M",capsLock:"M"},Comma:{shiftUp:",",shiftDown:"<",capsLock:","},Period:{shiftUp:".",shiftDown:">",capsLock:"."},Slash:{shiftUp:"/",shiftDown:"?",capsLock:"/"},CapsLock:{shiftUp:"CapsLock",shiftDown:"CapsLock",capsLock:"CapsLock"},Backslash:{shiftUp:"\\",shiftDown:"|",capsLock:"\\"},Enter:{shiftUp:"Enter",shiftDown:"Enter",capsLock:"Enter"},ShiftRight:{shiftUp:"",shiftDown:"Shift",capsLock:""},ArrowUp:{shiftUp:"ArrowUp",shiftDown:"ArrowUp",capsLock:"ArrowUp"},ArrowLeft:{shiftUp:"ArrowLeft",shiftDown:"ArrowLeft",capsLock:"ArrowLeft"},ArrowDown:{shiftUp:"ArrowDown",shiftDown:"ArrowDown",capsLock:"ArrowDown"},ArrowRight:{shiftUp:"ArrowRight",shiftDown:"ArrowRight",capsLock:"ArrowRight"},ControlRight:{shiftUp:"Control",shiftDown:"Control",capsLock:"Control"},AltRight:{shiftUp:"Alt",shiftDown:"AltGraph",capsLock:"AltGraph"},Space:{shiftUp:" ",shiftDown:" ",capsLock:" "},AltLeft:{shiftUp:"Alt",shiftDown:"Alt",capsLock:"Alt"},MetaLeft:{shiftUp:"Meta",shiftDown:"Meta",capsLock:"Meta"},ControlLeft:{shiftUp:"Control",shiftDown:"Control",capsLock:"Control"},ShiftLeft:{shiftUp:"",shiftDown:"Shift",capsLock:""},Tab:{shiftUp:"Tab",shiftDown:"Tab",capsLock:"Tab"},Backquote:{shiftUp:"`",shiftDown:"~",capsLock:"`"},Digit1:{shiftUp:"1",shiftDown:"!",capsLock:"1"},Digit2:{shiftUp:"2",shiftDown:"@",capsLock:"2"},Digit3:{shiftUp:"3",shiftDown:"#",capsLock:"3"},Digit4:{shiftUp:"4",shiftDown:"$",capsLock:"4"},Digit5:{shiftUp:"5",shiftDown:"%",capsLock:"5"},Digit6:{shiftUp:"6",shiftDown:"^",capsLock:"6"},Digit7:{shiftUp:"7",shiftDown:"&",capsLock:"7"},Digit8:{shiftUp:"8",shiftDown:"*",capsLock:"8"},Digit9:{shiftUp:"9",shiftDown:"(",capsLock:"9"},Digit0:{shiftUp:"0",shiftDown:")",capsLock:"0"},Minus:{shiftUp:"-",shiftDown:"_",capsLock:"-"},Equal:{shiftUp:"=",shiftDown:"+",capsLock:"="},Backspace:{shiftUp:"Backspace",shiftDown:"Backspace",capsLock:"Backspace"},Delete:{shiftUp:"Delete",shiftDown:"Delete",capsLock:"Delete"}}},s=["Backquote","Digit1","Digit2","Digit3","Digit4","Digit5","Digit6","Digit7","Digit8","Digit9","Digit0","Minus","Equal","Backspace","Tab","KeyQ","KeyW","KeyE","KeyR","KeyT","KeyY","KeyU","KeyI","KeyO","KeyP","BracketLeft","BracketRight","Backslash","CapsLock","KeyA","KeyS","KeyD","KeyF","KeyG","KeyH","KeyJ","KeyK","KeyL","Semicolon","Quote","Enter","ShiftLeft","KeyZ","KeyX","KeyC","KeyV","KeyB","KeyN","KeyM","Comma","Period","Slash","ArrowUp","ShiftRight","ControlLeft","MetaLeft","AltLeft","Space","AltRight","ControlRight","ArrowLeft","ArrowDown","ArrowRight","Delete"],e="keyboard__key_active",i="keyboard__key_caps_active",o="keyboard__key_shift",a="keyboard__key_shift_active",n="keyboard__key_alt",h="keyboard__key_alt_active",c="keyboard__key_ctrl",r="keyboard__key_ctrl_active",p="keyboard__key_medium",f="Shift",l="Ctrl";document.body.append((()=>{const t=document.createElement("main");t.className="main";const s=document.createElement("textarea");return s.classList.add("main__text","virtual-input"),s.setAttribute("wrap","hard"),s.setAttribute("cols","90"),s.placeholder="Клавиатура создана в операционной системе Windows\nДля переключения языка комбинация: левыe ctrl + alt",t.append(s),t})());const L=new class{constructor(){this.textAreaLink=document.querySelector(".virtual-input"),this.buttonLinks=[],this.capsLock=!1,this.shiftDown=!1,this.pressedButtons=[],this.lang=this.initLang(),this.lastItteractedKey=null,this.KEYS_EVENTS={ShiftRight:[this.toggleShift],ShiftLeft:[this.toggleShift],CapsLock:[this.toggleCapsLock],AltLeft:[this.toggleAlt,this.changeLang],AltRight:[this.toggleAlt],ControlLeft:[this.toggleCtrl,this.changeLang],ControlRight:[this.toggleCtrl],Enter:[this.insertEnter],Tab:[this.insertTab],KeyA:[this.insertButtonText],Backspace:[this.pressBackspace],Delete:[this.pressDel],ArrowUp:[this.insertArrowLikeText],ArrowDown:[this.insertArrowLikeText],ArrowLeft:[this.insertArrowLikeText],ArrowRight:[this.insertArrowLikeText],MetaLeft:[this.pressMeta],default:[this.insertButtonText]}}createComponent(){const t=document.createElement("div");t.className="keyboard";const e=document.createElement("div");return e.className="keyboard__keys",s.forEach((t=>{const s=this.createKeyboardButton(t);e.append(s),this.buttonLinks.push(s)})),this.updateKeyboardButtons(),t.append(e),this.addKeyboardEventListener(),t}createKeyboardButton(t){const s=document.createElement("button");return s.className="keyboard__key",s.setAttribute("data-key",t),this.addMouseEventListenerToButton(s),s}addMouseEventListenerToButton(t){const s=s=>{let e=s.target.getAttribute("data-key");this.lastItteractedKey||(this.lastItteractedKey=e),e=this.lastItteractedKey===e&&"mouseup"===s.type?e:this.lastItteractedKey,"mousedown"===s.type&&this.pressedButtons.includes(e)&&(t.dispatchEvent(new MouseEvent("mouseup")),this.lastItteractedKey=null),this.activateKeyEvents(e),this.lastItteractedKey="mousedown"===s.type?e:null};t.addEventListener("mousedown",s),t.addEventListener("mouseup",s)}activateKeyEvents(t){Object.keys(this.KEYS_EVENTS).includes(t)?this.KEYS_EVENTS[t].forEach((s=>{s.bind(this)(t)})):this.KEYS_EVENTS.default.forEach((s=>{s.bind(this)(t)}))}addKeyboardEventListener(){const t=t=>{t.preventDefault();const s=t.code;"keydown"===t.type&&this.pressedButtons.includes(s)&&document.body.dispatchEvent(new KeyboardEvent("keyup",{code:s})),this.activateKeyEvents(s)};document.body.addEventListener("keydown",t),document.body.addEventListener("keyup",t)}updateKeyboardButtons(){this.buttonLinks.map((t=>{const s=t.getAttribute("data-key"),L=t;switch(s){case"Space":L.classList.add("keyboard__key_space"),L.textContent="";break;case"CapsLock":this.capsLock?L.classList.add(i):L.classList.remove(i),L.classList.add("keyboard__key_caps",p),L.textContent="CapsLk";break;case"MetaLeft":L.classList.add("keyboard__key_win"),L.innerText="Win";break;case"ShiftLeft":this.pressedButtons.includes("ShiftLeft")?L.classList.add(a):L.classList.remove(a),L.classList.add(o,p),L.textContent=f;break;case"ShiftRight":this.pressedButtons.includes("ShiftRight")?L.classList.add(a):L.classList.remove(a),L.classList.add(o,p),L.textContent=f;break;case"Enter":L.classList.add(p),L.textContent="Enter";break;case"Backspace":t.classList.add(p),L.textContent="Backspace";break;case"ArrowLeft":L.textContent="←";break;case"ArrowRight":L.textContent="→";break;case"ArrowUp":L.textContent="↑";break;case"ArrowDown":L.textContent="↓";break;case"Tab":L.classList.add(p),L.classList.add("keyboard__key_tab"),L.textContent="Tab";break;case"AltRight":this.pressedButtons.includes("AltRight")?L.classList.add(h):L.classList.remove(h),L.classList.add(n),L.textContent="Alt";break;case"AltLeft":this.pressedButtons.includes("AltLeft")?L.classList.add(h):L.classList.remove(h),L.classList.add(n),L.textContent="Alt";break;case"ControlRight":this.pressedButtons.includes("ControlRight")?L.classList.add(r):L.classList.remove(r),L.classList.add(c),L.textContent=l;break;case"ControlLeft":this.pressedButtons.includes("ControlLeft")?L.classList.add(r):L.classList.remove(r),L.classList.add(c),L.textContent=l;break;default:L.textContent=this.getKeyText(s)}return this.pressedButtons.includes(s)?t.classList.add(e):t.classList.remove(e),L}))}toggleCapsLock(t){this.togglePressedKey(t),this.pressedButtons.includes("CapsLock")&&(this.capsLock=!this.capsLock),this.updateKeyboardButtons()}toggleShift(t){this.togglePressedKey(t),this.shiftDown=this.pressedButtons.includes("ShiftRight")||this.pressedButtons.includes("ShiftLeft"),this.updateKeyboardButtons()}toggleAlt(t){this.togglePressedKey(t),this.alt=this.pressedButtons.includes("AltRight")||this.pressedButtons.includes("AltLeft"),this.updateKeyboardButtons()}toggleCtrl(t){this.togglePressedKey(t),this.ctrl=this.pressedButtons.includes("ControlRight")||this.pressedButtons.includes("ControlLeft"),this.updateKeyboardButtons()}insertButtonText(t){this.togglePressedKey(t),this.pressedButtons.includes(t)&&this.insertTextAtTextAreaCursor(this.getKeyText(t)),this.updateKeyboardButtons()}insertEnter(t){this.togglePressedKey(t),this.pressedButtons.includes(t)&&this.insertTextAtTextAreaCursor("\r\n"),this.updateKeyboardButtons()}insertTab(t){this.togglePressedKey(t),this.pressedButtons.includes(t)&&this.insertTextAtTextAreaCursor("\t"),this.updateKeyboardButtons()}pressBackspace(t){this.togglePressedKey(t),this.pressedButtons.includes(t)&&this.deleteTextAtTextAreaCursor(!0),this.updateKeyboardButtons()}pressDel(t){this.togglePressedKey(t),this.pressedButtons.includes(t)&&this.deleteTextAtTextAreaCursor(!1,!0),this.updateKeyboardButtons()}insertArrowLikeText(t){const s={ArrowUp:"↑",ArrowLeft:"←",ArrowDown:"↓",ArrowRight:"→"};this.togglePressedKey(t),this.pressedButtons.includes(t)&&this.insertTextAtTextAreaCursor(s[t]),this.updateKeyboardButtons()}pressArrow(t){this.togglePressedKey(t),this.pressedButtons.includes(t)&&this.navigateTextAreaCursor("ArrowUp"===t,"ArrowLeft"===t,"ArrowDown"===t,"ArrowRight"===t),this.updateKeyboardButtons()}pressMeta(t){this.togglePressedKey(t),this.updateKeyboardButtons()}selectAll(){this.preventNext=!0,this.pressedButtons.includes("ControlLeft")&&this.pressedButtons.includes("KeyA")&&2===this.pressedButtons.length&&(this.textAreaLink.selectionStart=0,this.textAreaLink.selectionEnd=this.textAreaLink.value.length),this.updateKeyboardButtons()}changeLang(){this.pressedButtons.includes("AltLeft")&&this.pressedButtons.includes("ControlLeft")&&2===this.pressedButtons.length&&("eng"===this.lang?this.lang="rus":this.lang="eng",localStorage.setItem("virtualKeyboard:lang",this.lang),this.updateKeyboardButtons())}getKeyText(s){let e;return this.shiftDown?(e=t[this.lang][s].shiftDown,this.capsLock&&e.toUpperCase()!==e.toLowerCase()&&(e=t[this.lang][s].shiftUp)):e=this.capsLock?t[this.lang][s].capsLock:t[this.lang][s].shiftUp,e}initLang(){return null!==localStorage.getItem("virtualKeyboard:lang")?localStorage.getItem("virtualKeyboard:lang"):(localStorage.setItem("virtualKeyboard:lang","eng"),this.lang="eng","eng")}togglePressedKey(t){this.pressedButtons.includes(t)?this.pressedButtons.splice(this.pressedButtons.indexOf(t),1):this.pressedButtons.push(t)}insertTextAtTextAreaCursor(t){this.textAreaLink.focus();const s=this.textAreaLink.selectionStart,e=this.textAreaLink.selectionEnd;this.textAreaLink.value=this.textAreaLink.value.substring(0,s)+t+this.textAreaLink.value.substring(e,this.textAreaLink.value.length);const i=s+t.length;this.textAreaLink.selectionStart=i,this.textAreaLink.selectionEnd=i}deleteTextAtTextAreaCursor(t=!1,s=!1){this.textAreaLink.focus();const e=this.textAreaLink.selectionStart,i=this.textAreaLink.selectionEnd;if(e!==i)this.textAreaLink.value=this.textAreaLink.value.substring(0,e)+this.textAreaLink.value.substring(i,this.textAreaLink.value.length),this.textAreaLink.selectionStart=e,this.textAreaLink.selectionEnd=e;else{if(t){if(0===e)return;this.textAreaLink.value=this.textAreaLink.value.substring(0,e-1)+this.textAreaLink.value.substring(i,this.textAreaLink.value.length),this.textAreaLink.selectionStart=e-1,this.textAreaLink.selectionEnd=e-1}s&&(this.textAreaLink.value=this.textAreaLink.value.substring(0,e)+this.textAreaLink.value.substring(i+1,this.textAreaLink.value.length),this.textAreaLink.selectionStart=e,this.textAreaLink.selectionEnd=e)}}navigateTextAreaCursor(t=!1,s=!1,e=!1,i=!1){this.textAreaLink.focus();const o=this.textAreaLink.selectionStart,a=this.textAreaLink.selectionEnd;if(t){const t=this.textAreaLink.value.substring(0,o).lastIndexOf("\n"),s=this.textAreaLink.value.substring(0,t).lastIndexOf("\n"),e=o-t;if(-1===t)return;t-s>e?(this.textAreaLink.selectionStart=s+e,this.textAreaLink.selectionEnd=s+e):(this.textAreaLink.selectionStart=t,this.textAreaLink.selectionEnd=t)}if(e){const t=this.textAreaLink.value.substring(0,o).lastIndexOf("\n"),s=o+this.textAreaLink.value.substring(o,this.textAreaLink.value.length).indexOf("\n"),e=-1===this.textAreaLink.value.substring(s+1,this.textAreaLink.value.length).indexOf("\n")?this.textAreaLink.value.length:s+this.textAreaLink.value.substring(s+1,this.textAreaLink.value.length).indexOf("\n");if(-1===this.textAreaLink.value.substring(o,this.textAreaLink.value.length).indexOf("\n"))return;e<s+(o-t)?(this.textAreaLink.selectionStart=e+1,this.textAreaLink.selectionEnd=e+1):(this.textAreaLink.selectionStart=s+(o-t),this.textAreaLink.selectionEnd=s+(o-t))}i&&(o!==a?(this.textAreaLink.selectionStart=a,this.textAreaLink.selectionEnd=a):(this.textAreaLink.selectionStart=o+1,this.textAreaLink.selectionEnd=o+1)),s&&(o!==a||0===o?(this.textAreaLink.selectionStart=o,this.textAreaLink.selectionEnd=o):(this.textAreaLink.selectionStart=o-1,this.textAreaLink.selectionEnd=o-1))}};document.body.append(L.createComponent())})();